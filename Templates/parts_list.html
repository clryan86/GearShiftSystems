{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="title">Parts</div>

  <div class="toolbar" style="margin-bottom:10px;">
    <a class="btn btn-primary" href="{{ url_for('add_part') }}">Add Part</a>
    <a class="btn btn-light" href="{{ url_for('list_parts') }}">All Parts</a>
    <a class="btn btn-warn" href="{{ url_for('list_parts') }}?low=1">Low Stock Only</a>
    <a class="btn btn-light" href="{{ url_for('export_parts') }}">Export CSV</a>
  </div>

  {% if parts|length == 0 %}
    <p class="muted" style="margin-top:10px">No parts found.</p>
  {% else %}
  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Name</th>
          <th>SKU</th>
          <th class="right">Price</th>
          <th class="right">Stock</th>
          <th class="right">Threshold</th>
          <th>Shelf</th>
          <th>Vendor</th>
          <th class="right">Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for p in parts %}
        {% set stock_val = (p.stock|default(0, true))|int %}
        {% set thresh_val = (p.reorder_threshold|default(0, true))|int %}
        {% set is_low = stock_val <= thresh_val %}
        {% set vendor_label =
            (p.vendor and (p.vendor.name or p.vendor.company_name)) or
            p.vendor_name or
            (vendors_by_id and p.vendor_id and vendors_by_id.get(p.vendor_id) and (vendors_by_id.get(p.vendor_id).name or vendors_by_id.get(p.vendor_id).company_name)) or
            p.vendor_id or
            '—'
        %}
        <tr class="{{ 'row-low' if is_low }}">
          <td>
            {{ p.name }}
            {% if is_low %}<span class="badge badge-low" title="At/below threshold">LOW</span>{% endif %}
            <div class="muted small">SKU: {{ p.sku }}</div>
          </td>
          <td>{{ p.sku }}</td>
          <td class="right">${{ '%.2f'|format((p.price|default(0, true))|float) }}</td>
          <td class="right">{{ stock_val }}</td>
          <td class="right">{{ thresh_val }}</td>
          <td>{{ p.shelf_location|default('—', true) }}</td>
          <td>{{ vendor_label }}</td>
          <td class="right">
            <a class="btn btn-small" href="{{ url_for('edit_part', part_id=p.id) }}">Edit</a>
            <form action="{{ url_for('delete_part', part_id=p.id) }}" method="post" style="display:inline" onsubmit="return confirm('Delete this part?');">
              <button type="submit" class="btn btn-small btn-warn">Delete</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}
</div>
{% endblock %}