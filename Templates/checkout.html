{% extends "base.html" %}
{% block content %}
<div class="card">
  <div class="title">Checkout</div>

  <p class="muted">
    You're purchasing: <strong>{{ part.name }}</strong> (SKU: {{ part.sku }})
  </p>
  <p>
    Price: ${{ "%.2f"|format(part.price) }} &nbsp; | &nbsp; Stock: {{ part.stock }}
  </p>

  <div id="paypal-button-container" class="mt-3"></div>
  <div id="status" class="mt-3"></div>
</div>

<!-- Sandbox works instantly with client-id=sb -->
<script src="https://www.paypal.com/sdk/js?client-id={{ paypal_client_id }}&currency=USD&intent=capture"></script>
<script>
paypal.Buttons({
  style: { layout: 'vertical', shape: 'rect' },
  createOrder: (data, actions) => actions.order.create({
    purchase_units: [{
      description: '{{ part.name }} ({{ part.sku }})',
      amount: { value: '{{ "%.2f"|format(part.price) }}' }
    }]
  }),
  onApprove: (data, actions) => actions.order.capture().then(details => {
    document.getElementById('status').innerHTML =
      '<div class="alert alert-success">✅ Payment ' + (details.status || 'OK') +
      '. Thanks, ' + ((details.payer && details.payer.name && details.payer.name.given_name) || 'buyer') + '!</div>';
  }),
  onError: err => {
    document.getElementById('status').innerHTML =
      '<div class="alert alert-danger">❌ ' + (err && err.message ? err.message : err) + '</div>';
  }
}).render('#paypal-button-container');
</script>
{% endblock %}
