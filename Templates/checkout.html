{% extends "base.html" %}
{% block content %}

<a class="btn mb-3" href="{{ url_for('cart.view_cart') }}"
   style="background:#1e293b; color:#38bdf8; border:1px solid #334155;">
  ⬅️ Back to Cart
</a>

<div class="card">
  <div class="title">Checkout</div>

  {% if items|length == 0 %}
    <p class="muted">Your cart is empty.</p>
  {% else %}
    <div class="table-wrap">
      <table class="table">
        <thead>
          <tr>
            <th>Item</th>
            <th>SKU</th>
            <th class="right">Price</th>
            <th class="right">Qty</th>
            <th class="right">Line Total</th>
          </tr>
        </thead>
        <tbody>
          {% for part, qty, line in items %}
          <tr>
            <td>{{ part.name }}</td>
            <td>{{ part.sku }}</td>
            <td class="right">${{ '%.2f'|format((part.price or 0.0)|float) }}</td>
            <td class="right">{{ qty }}</td>
            <td class="right">${{ '%.2f'|format(line) }}</td>
          </tr>
          {% endfor %}
        </tbody>
        <tfoot>
          <tr>
            <th colspan="4" class="right">Total</th>
            <th class="right">${{ '%.2f'|format(subtotal) }}</th>
          </tr>
        </tfoot>
      </table>
    </div>

    <!-- Simple confirmation path: posts to cart.checkout_submit which decrements stock,
         clears the cart, and flashes a PayPal-style confirmation message. -->
    <form method="post" action="{{ url_for('cart.checkout_submit') }}" style="margin-top:12px;">
      <button class="btn btn-accent" type="submit">Confirm Purchase with PayPal</button>
    </form>

    <p class="muted" style="margin-top:8px;">
      On confirmation, your order is marked as paid via PayPal (sandbox) and inventory is updated.
    </p>
  {% endif %}
</div>

{% endblock %}
